<script th:fragment="script">
  lucide.createIcons();

  function toggleSidebar() {
    const sidebar = document.getElementById("sidebar");
    const labels = document.querySelectorAll(".menu-label");
    const userInfo = document.getElementById("user-info");
    const icon = document.getElementById("sidebar-toggle-icon");

    const isCollapsed = sidebar.classList.contains("w-20");

    if (isCollapsed) {
      sidebar.classList.remove("w-20");
      sidebar.classList.add("w-64");
      labels.forEach(el => el.classList.remove("hidden"));
      userInfo.classList.remove("hidden");
      icon.setAttribute("data-lucide", "menu");
    } else {
      sidebar.classList.remove("w-64");
      sidebar.classList.add("w-20");
      labels.forEach(el => el.classList.add("hidden"));
      userInfo.classList.add("hidden");
      icon.setAttribute("data-lucide", "x");
    }

    lucide.createIcons();
  }

  function toggleProfileMenu() {
    const dropdown = document.getElementById("profile-dropdown");
    dropdown.classList.toggle("hidden");
  }

  document.addEventListener("click", function (e) {
    const avatar = e.target.closest("div[onclick='toggleProfileMenu()'], img[onclick='toggleProfileMenu()']");
    const dropdown = document.getElementById("profile-dropdown");
    if (!dropdown.contains(e.target) && !avatar) {
      dropdown.classList.add("hidden");
    }
  });

  function handleLogout() {
    showToast("Đăng xuất thành công");
    setTimeout(() => {
      window.location.href = '/admin-logout';
    }, 1000);
  }

  function toggleAuth() {
    const label = document.getElementById("auth-label");
    const btn = document.getElementById("auth-btn");
    const icon = btn.querySelector("i");

    if (label.textContent === "Logout") {
      label.textContent = "Login";
      btn.classList.replace("bg-red-500", "bg-green-600");
      btn.classList.replace("hover:bg-red-600", "hover:bg-green-700");
      icon.setAttribute("data-lucide", "log-in");
      showToast("Đã logout");
    } else {
      label.textContent = "Logout";
      btn.classList.replace("bg-green-600", "bg-red-500");
      btn.classList.replace("hover:bg-green-700", "hover:bg-red-600");
      icon.setAttribute("data-lucide", "log-out");
      showToast("Đã login");
    }

    lucide.createIcons();
  }

  function showToast(msg) {
    const toast = document.getElementById("toast");
    if (toast) {
      toast.textContent = `✅ ${msg}`;
      toast.classList.remove("hidden");
      setTimeout(() => toast.classList.add("hidden"), 2000);
    } else {
      alert(msg);
    }
  }

  function safeSet(id, text) {
    const el = document.getElementById(id);
    if (el) el.textContent = text;
  }

  function generateStats() {
    safeSet("product-count", Math.floor(Math.random() * 500 + 100));
    safeSet("order-count", Math.floor(Math.random() * 200 + 50));
    safeSet("user-count", Math.floor(Math.random() * 1000 + 300));
    safeSet("revenue-count", "₫" + (Math.floor(Math.random() * 50) + 10).toLocaleString('vi-VN') + ",000,000");
    safeSet("message-count", Math.floor(Math.random() * 10));
    safeSet("notif-count", Math.floor(Math.random() * 5 + 1));
  }

  function toggleSubMenu(id) {
    const submenu = document.getElementById(id);
    submenu.classList.toggle("hidden");
  }

  generateStats();
</script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:fragment="script">

// 1. Đơn hàng theo tháng
const months = ['1', '2', '3', '4', '5', '6'];
const ordersData = [10, 20, 15, 30, 25, 40];

new Chart(document.getElementById('ordersChart'), {
  type: 'bar',
  data: {
    labels: months,
    datasets: [{
      label: 'Số đơn hàng',
      data: ordersData,
      backgroundColor: '#3b82f6'
    }]
  },
  options: { responsive: true, scales: { y: { beginAtZero: true } } }
});

// 2. Doanh thu theo tháng
const revenueData = [5, 8, 3, 10, 7, 12];

new Chart(document.getElementById('revenueChart'), {
  type: 'line',
  data: {
    labels: months,
    datasets: [{
      label: 'Doanh thu (triệu ₫)',
      data: revenueData,
      borderColor: '#10b981',
      backgroundColor: 'rgba(16,185,129,0.2)',
      fill: true,
      tension: 0.4
    }]
  },
  options: { responsive: true, scales: { y: { beginAtZero: true } } }
});

// 3. Sản phẩm theo danh mục
const categoryLabels = ['Laptop', 'Điện thoại', 'Phụ kiện', 'Khác'];
const categoryData = [120, 200, 80, 50];

new Chart(document.getElementById('productChart'), {
  type: 'bar',
  data: {
    labels: categoryLabels,
    datasets: [{
      label: 'Sản phẩm',
      data: categoryData,
      backgroundColor: '#6366f1'
    }]
  },
  options: { responsive: true, scales: { y: { beginAtZero: true } } }
});

// 4. Khách hàng theo tháng
const userData = [15, 25, 20, 35, 40, 50];

new Chart(document.getElementById('userChart'), {
  type: 'line',
  data: {
    labels: months,
    datasets: [{
      label: 'Khách hàng mới',
      data: userData,
      borderColor: '#f59e0b',
      backgroundColor: 'rgba(251,191,36,0.2)',
      fill: true,
      tension: 0.4
    }]
  },
  options: { responsive: true, scales: { y: { beginAtZero: true } } }
});
</script>
